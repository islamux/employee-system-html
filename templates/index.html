<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة الموظفين</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
            direction: rtl; /* تحويل الاتجاه إلى اليمين إلى اليسار */
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px 20px;
            margin: 0 5px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        .tab-button.active {
            background-color: #0056b3;
        }
        .tab-content {
            display: none;
            padding: 20px;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
        }
        .tab-content.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            direction: rtl; /* ضمان اتجاه الجدول من اليمين إلى اليسار */
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 12px;
            text-align: right; /* محاذاة النصوص إلى اليمين */
        }
        th {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #f1f1f1;
        }
        .form-group {
            margin-bottom: 15px;
            text-align: right; /* محاذاة النصوص إلى اليمين */
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            text-align: right; /* محاذاة النصوص إلى اليمين */
        }
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            direction: rtl; /* جعل حقول الإدخال تتبع الاتجاه من اليمين إلى اليسار */
        }
        button {
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        button:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>نظام إدارة الموظفين</h1>

        <!-- التبويبات -->
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('add-employee')">إضافة موظف</button>
            <button class="tab-button" onclick="switchTab('attendance')">الحضور والانصراف</button>
            <button class="tab-button" onclick="switchTab('leave')">تسجيل الإجازات</button>
            <button class="tab-button" onclick="switchTab('report')">توليد التقرير الشهري</button>
        </div>

        <!-- إضافة موظف -->
        <div id="add-employee" class="tab-content active">
            <h2>إضافة موظف جديد</h2>
            <div class="form-group">
                <label for="name">اسم الموظف:</label>
                <select id="name" required>
                    <option value="" disabled selected>اختر اسم الموظف</option>
                    {% for name in predefined_names %}
                        <option value="{{ name }}">{{ name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="position">المنصب:</label>
                <select id="position" required>
                    <option value="" disabled selected>اختر المنصب</option>
                    {% for position in predefined_positions %}
                        <option value="{{ position }}">{{ position }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="salary">الراتب:</label>
                <select id="salary" required>
                    <option value="" disabled selected>اختر الراتب</option>
                    {% for salary in predefined_salaries %}
                        <option value="{{ salary }}">{{ salary }}</option>
                    {% endfor %}
                </select>
            </div>
            <button onclick="addEmployee()">إضافة موظف</button>
        </div>

        <!-- تسجيل الحضور والانصراف -->
        <div id="attendance" class="tab-content">
            <h2>تسجيل الحضور والانصراف</h2>
            <div class="form-group">
                <label for="checkInEmployeeId">معرف الموظف:</label>
                <input type="number" id="checkInEmployeeId" placeholder="أدخل معرف الموظف">
            </div>
            <div class="form-group">
                <label for="checkInTime">وقت الحضور:</label>
                <input type="time" id="checkInTime">
            </div>
            <button onclick="recordCheckIn()">تسجيل الحضور</button>

            <hr>

            <div class="form-group">
                <label for="checkOutEmployeeId">معرف الموظف:</label>
                <input type="number" id="checkOutEmployeeId" placeholder="أدخل معرف الموظف">
            </div>
            <div class="form-group">
                <label for="checkOutTime">وقت الانصراف:</label>
                <input type="time" id="checkOutTime">
            </div>
            <button onclick="recordCheckOut()">تسجيل الانصراف</button>
        </div>

        <!-- تسجيل الإجازات -->
        <div id="leave" class="tab-content">
            <h2>تسجيل إجازة</h2>
            <div class="form-group">
                <label for="leaveEmployeeId">معرف الموظف:</label>
                <input type="number" id="leaveEmployeeId" placeholder="أدخل معرف الموظف">
            </div>
            <div class="form-group">
                <label for="leaveType">نوع الإجازة:</label>
                <select id="leaveType">
                    <option value="annual">سنوية</option>
                    <option value="emergency">طارئة</option>
                </select>
            </div>
            <div class="form-group">
                <label for="startDate">تاريخ البداية:</label>
                <input type="date" id="startDate">
            </div>
            <div class="form-group">
                <label for="endDate">تاريخ النهاية:</label>
                <input type="date" id="endDate">
            </div>
            <button onclick="recordLeave()">تسجيل الإجازة</button>
        </div>

        <!-- توليد التقرير الشهري -->
        <div id="report" class="tab-content">
            <h2>توليد التقرير الشهري</h2>
            <button onclick="generateReport()">توليد التقرير الشهري</button>

            <div id="reportContainer" style="display: none;">
                <h2>التقرير الشهري</h2>
                <table id="reportTable">
                    <thead>
                        <tr>
                            <th>اسم الموظف</th>
                            <th>ساعات التأخير</th>
                            <th>ساعات الخروج المبكر</th>
                            <th>رصيد الإجازات السنوية</th>
                            <th>رصيد الإجازات الطارئة</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- بيانات التقرير ستُضاف هنا -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // تبديل التبويبات
        function switchTab(tabId) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));

            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        // إضافة موظف
        async function addEmployee() {
            const name = document.getElementById('name').value.trim();
            const position = document.getElementById('position').value.trim();
            const salary = document.getElementById('salary').value.trim();

            if (!name || !position || !salary) {
                alert('يرجى ملء جميع الحقول');
                return;
            }

            const response = await fetch('/add_employee', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `name=${name}&position=${position}&salary=${salary}`
            });

            const result = await response.json();
            alert(result.message || result.error);
        }

        // تسجيل الحضور
        async function recordCheckIn() {
            const employeeId = document.getElementById('checkInEmployeeId').value.trim();
            const checkInTime = document.getElementById('checkInTime').value.trim();

            if (!employeeId || !checkInTime) {
                alert('يرجى ملء جميع الحقول');
                return;
            }

            const response = await fetch('/record_check_in', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `employee_id=${employeeId}&check_in_time=${checkInTime}`
            });

            const result = await response.json();
            alert(result.message || result.error);
        }

        // تسجيل الانصراف
        async function recordCheckOut() {
            const employeeId = document.getElementById('checkOutEmployeeId').value.trim();
            const checkOutTime = document.getElementById('checkOutTime').value.trim();

            if (!employeeId || !checkOutTime) {
                alert('يرجى ملء جميع الحقول');
                return;
            }

            const response = await fetch('/record_check_out', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `employee_id=${employeeId}&check_out_time=${checkOutTime}`
            });

            const result = await response.json();
            alert(result.message || result.error);
        }

        // تسجيل الإجازة
        async function recordLeave() {
            const employeeId = document.getElementById('leaveEmployeeId').value.trim();
            const leaveType = document.getElementById('leaveType').value.trim();
            const startDate = document.getElementById('startDate').value.trim();
            const endDate = document.getElementById('endDate').value.trim();

            if (!employeeId || !leaveType || !startDate || !endDate) {
                alert('يرجى ملء جميع الحقول');
                return;
            }

            const response = await fetch('/record_leave', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `employee_id=${employeeId}&leave_type=${leaveType}&start_date=${startDate}&end_date=${endDate}`
            });

            const result = await response.json();
            alert(result.message || result.error);
        }

        // توليد التقرير الشهري
        async function generateReport() {
            const response = await fetch('/generate_report');
            const report = await response.json();

            const reportTableBody = document.querySelector('#reportTable tbody');
            reportTableBody.innerHTML = '';

            report.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.total_late_hours.toFixed(2)}</td>
                    <td>${item.total_early_departure_hours.toFixed(2)}</td>
                    <td>${item.annual_leave_balance}</td>
                    <td>${item.emergency_leave_balance}</td>
                `;
                reportTableBody.appendChild(row);
            });

            document.getElementById('reportContainer').style.display = 'block';
        }
    </script>
</body>
</html>